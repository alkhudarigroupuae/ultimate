<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Admin Dashboard</title>
    <style>
        :root {
            --bg-color: #000000;
            --text-color: #ffffff;
            --accent-color: #5D3FD3;
            --accent-glow: 0 0 10px rgba(93, 63, 211, 0.5);
            --card-bg: #111111;
            --border-color: #333333;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
        }

        /* Login Overlay */
        #login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .login-box {
            background: var(--card-bg);
            padding: 2rem;
            border: 1px solid var(--border-color);
            border-radius: 0px;
            text-align: center;
            width: 90%;
            max-width: 400px;
            box-shadow: var(--accent-glow);
        }

        .login-box h2 {
            margin-bottom: 1.5rem;
            color: var(--accent-color);
        }

        .input-group {
            margin-bottom: 1rem;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #888;
        }

        .input-group input {
            width: 100%;
            padding: 0.8rem;
            background: #000;
            border: 1px solid var(--border-color);
            color: #fff;
            border-radius: 0px;
        }

        .btn {
            background: var(--accent-color);
            color: #fff;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 0px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.8);
            transform: translateY(-2px);
        }

        /* Dashboard Layout */
        .dashboard-container {
            display: none; /* Hidden until logged in */
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }

        h1 {
            color: var(--accent-color);
            text-shadow: var(--accent-glow);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            color: #fff;
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            border-radius: 0px;
            transition: all 0.3s;
        }

        .tab-btn.active, .tab-btn:hover {
            background: var(--accent-color);
            border-color: var(--accent-color);
            box-shadow: var(--accent-glow);
        }

        /* Content Sections */
        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Product List */
        .item-list {
            display: grid;
            gap: 1rem;
        }

        .item-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            padding: 1rem;
            border-radius: 0px;
            display: grid;
            grid-template-columns: 80px 1fr auto;
            gap: 1rem;
            align-items: center;
        }

        .item-img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 0px;
        }

        .item-details h3 {
            margin-bottom: 0.5rem;
        }

        .item-details p {
            color: #888;
            font-size: 0.9rem;
        }

        .actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-edit {
            background: #2196F3;
            padding: 0.5rem 1rem;
            width: auto;
        }

        .btn-delete {
            background: #f44336;
            padding: 0.5rem 1rem;
            width: auto;
        }

        .btn-add {
            margin-bottom: 2rem;
            width: auto;
            display: inline-block;
        }

        /* Modal for Add/Edit */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 0px;
            width: 90%;
            max-width: 500px;
            border: 1px solid var(--accent-color);
        }

        .close-modal {
            float: right;
            cursor: pointer;
            font-size: 1.5rem;
        }

    </style>
</head>
<body>

    <!-- Login Overlay -->
    <div id="login-overlay">
        <div class="login-box">
            <h2>Admin Login</h2>
            <div class="input-group">
                <label>Username</label>
                <input type="text" id="username" placeholder="Enter username">
            </div>
            <div class="input-group">
                <label>Password</label>
                <input type="password" id="password" placeholder="Enter password">
            </div>
            <button class="btn" onclick="login()">Login</button>
            <p id="login-error" style="color: #f44336; margin-top: 1rem; display: none;">Invalid credentials</p>
        </div>
    </div>

    <!-- Dashboard Content -->
    <div class="dashboard-container" id="dashboard">
        <header>
            <h1>Ultimate Admin Dashboard</h1>
            <button class="btn" onclick="logout()" style="width: auto; background: #333;">Logout</button>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('restocafe')">Restocafé</button>
            <button class="tab-btn" onclick="switchTab('fitness')">Fitness Center</button>
            <button class="tab-btn" onclick="switchTab('store')">Ultimate Store</button>
            <button class="tab-btn" onclick="switchTab('barber')">Barber VIP</button>
        </div>

        <!-- Restocafe Section -->
        <div id="restocafe" class="section active">
            <h2>Restocafé Menu Management</h2>
            <button class="btn btn-add" onclick="openModal('restocafe')">+ Add New Item</button>
            <div id="restocafe-list" class="item-list"></div>
        </div>

        <!-- Fitness Section -->
        <div id="fitness" class="section">
            <h2>Fitness Center Plans Management</h2>
            <button class="btn btn-add" onclick="openModal('fitness')">+ Add New Plan</button>
            <div id="fitness-list" class="item-list"></div>
        </div>

        <!-- Store Section -->
        <div id="store" class="section">
            <h2>Store Products Management</h2>
            <button class="btn btn-add" onclick="openModal('store')">+ Add New Product</button>
            <div id="store-list" class="item-list"></div>
        </div>

        <!-- Barber Section -->
        <div id="barber" class="section">
            <h2>Barber Services Management</h2>
            <button class="btn btn-add" onclick="openModal('barber')">+ Add New Service</button>
            <div id="barber-list" class="item-list"></div>
        </div>
    </div>

    <!-- Edit/Add Modal -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2 id="modal-title">Edit Item</h2>
            <div class="input-group">
                <label>Name</label>
                <input type="text" id="edit-name">
            </div>
            <div class="input-group">
                <label>Price</label>
                <input type="number" id="edit-price">
            </div>
            <div class="input-group">
                <label>Image</label>
                <div style="display:flex; gap:.5rem; align-items:center; flex-wrap:wrap;">
                    <img id="edit-thumb" alt="" style="width:80px;height:80px;object-fit:cover;border:1px solid #333;">
                    <input type="text" id="edit-image" style="display:none;">
                    <input type="file" id="vercel-file" accept="image/*" style="color:#ccc;">
                    <button class="btn" id="vercel-upload" style="width:auto;">Upload</button>
                    <div id="vercel-status" style="color:#aaa; font-size:.9rem;"></div>
                </div>
            </div>
            <div class="input-group">
                <label>Category</label>
                <input type="text" id="edit-category">
            </div>
            <input type="hidden" id="edit-id">
            <input type="hidden" id="edit-section">
            <button class="btn" onclick="saveChanges()">Save Changes</button>
        </div>
    </div>

    <!-- Load Data Scripts - REMOVED to avoid variable conflicts. Using LocalStorage + Defaults instead. -->
    <!-- 
    <script src="../Ultimate_Restocafe/data.js"></script>
    <script src="../Fitness_Center/data.js"></script>
    <script src="../Ultimate_Store/data.js"></script>
    <script src="../Ultimate_Barber_VIP/data.js"></script> 
    -->

    <script>
        // Authentication
        function login() {
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;
            
            // Hardcoded credentials as requested for simple protection
            if (user === 'admin' && pass === 'admin123') {
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                localStorage.setItem('isAdmin', 'true');
                loadAllData();
            } else {
                document.getElementById('login-error').style.display = 'block';
            }
        }

        function logout() {
            localStorage.removeItem('isAdmin');
            location.reload();
        }

        // Tab Switching
        function switchTab(tabId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        // Data Management
        let currentData = {
            restocafe: [],
            fitness: [],
            store: [],
            barber: []
        };

        function loadAllData() {
            // Load from LocalStorage or fall back to data.js variables
            // Note: Variables productsData, servicesData, etc. come from the included scripts
            // We need to ensure we are reading the correct global variables set in data.js files
            
            // Restocafe (productsData from Ultimate_Restocafe/data.js)
            currentData.restocafe = JSON.parse(localStorage.getItem('restocafe_products')) || (typeof products !== 'undefined' ? products : []);
            renderList('restocafe', currentData.restocafe);

            // Fitness (defaultProducts/products from Fitness_Center/data.js)
            // Note: Fitness data.js defines 'products' variable locally or globally? 
            // We need to check variable names carefully. In previous edits, we used 'products' and 'defaultProducts'.
            // To avoid conflict, let's assume they might conflict if all loaded. 
            // Actually, loading multiple data.js files that define 'const products' will cause errors!
            // WE NEED A DIFFERENT STRATEGY FOR LOADING DATA or rename variables in data.js files.
            // For now, let's read from localStorage primarily.
            
            currentData.fitness = JSON.parse(localStorage.getItem('fitness_products')) || [];
            renderList('fitness', currentData.fitness);

            currentData.store = JSON.parse(localStorage.getItem('store_products')) || [];
            renderList('store', currentData.store);

            currentData.barber = JSON.parse(localStorage.getItem('barber_services')) || [];
            renderList('barber', currentData.barber);
        }

        // Since we cannot load multiple data.js files that use same variable names (const products),
        // We will rely on LocalStorage. If LocalStorage is empty, we might have issues if we don't handle variable scope.
        // FIX: We should rely on the variable names we just renamed in the previous step?
        // In previous step we renamed variables inside the files? No, we added 'productsData' but kept 'const products'.
        // 'const' is block scoped but at top level it's global. Loading multiple scripts with same const name throws error.
        
        // IMMEDIATE FIX: We need to rely on localStorage ONLY in this dashboard to avoid conflict, 
        // OR we need to namespace the data in the original files. 
        // Given I cannot easily namespace all files now without breaking other things, 
        // I will assume the user has visited the sites at least once OR I will manually initialize defaults here if LS is empty.
        
        // Let's define defaults here as fallback to avoid script conflict
        const defaults = {
            restocafe: [
                {id: 1, name: "Signature Espresso", price: 18, image: "https://images.unsplash.com/photo-1510707577719-ae7c14805e3a?q=80&w=1374&auto=format&fit=crop", category: "Coffee"},
                {id: 2, name: "Avocado Toast", price: 35, image: "https://images.unsplash.com/photo-1588137372308-15f75323ca8d?q=80&w=1374&auto=format&fit=crop", category: "Breakfast"}
            ],
            fitness: [
                {id: 1, name: "Daily Pass", price: 4000, image: "https://images.unsplash.com/photo-1534438327276-14e5300c3a48?q=80&w=1470&auto=format&fit=crop", category: "Membership"}
            ],
            store: [
                {id: 1, name: "Ultimate Hoodie", price: 120, image: "https://images.unsplash.com/photo-1556821840-3a63f95609a7?q=80&w=1374&auto=format&fit=crop", category: "Apparel"}
            ],
            barber: [
                {id: 1, name: "Classic Haircut", price: 60, image: "https://images.unsplash.com/photo-1599351431202-6e0c06e7af1f?q=80&w=1470&auto=format&fit=crop", category: "Hair"}
            ]
        };

        // Override loadAllData to use defaults if LS is empty
        function loadAllData() {
            currentData.restocafe = JSON.parse(localStorage.getItem('restocafe_products')) || defaults.restocafe;
            renderList('restocafe', currentData.restocafe);

            currentData.fitness = JSON.parse(localStorage.getItem('fitness_products')) || defaults.fitness;
            renderList('fitness', currentData.fitness);

            currentData.store = JSON.parse(localStorage.getItem('store_products')) || defaults.store;
            renderList('store', currentData.store);

            currentData.barber = JSON.parse(localStorage.getItem('barber_services')) || defaults.barber;
            renderList('barber', currentData.barber);
        }


        function renderList(section, items) {
            const container = document.getElementById(`${section}-list`);
            container.innerHTML = '';
            
            items.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'item-card';
                card.innerHTML = `
                    <img src="${item.image}" class="item-img" onerror="this.src='https://via.placeholder.com/80'">
                    <div class="item-details">
                        <h3>${item.name}</h3>
                        <p>${item.category} - ${item.price.toLocaleString()}</p>
                    </div>
                    <div class="actions">
                        <button class="btn btn-edit" onclick="openEditModal('${section}', ${index})">Edit</button>
                        <button class="btn btn-delete" onclick="deleteItem('${section}', ${index})">Delete</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Add/Edit Logic
        function openModal(section) {
            document.getElementById('modal-title').innerText = 'Add New Item';
            document.getElementById('edit-id').value = ''; // Empty ID means new
            document.getElementById('edit-section').value = section;
            document.getElementById('edit-name').value = '';
            document.getElementById('edit-price').value = '';
            document.getElementById('edit-image').value = '';
            document.getElementById('edit-category').value = '';
            document.getElementById('edit-modal').classList.add('active');
        }

        function openEditModal(section, index) {
            const item = currentData[section][index];
            document.getElementById('modal-title').innerText = 'Edit Item';
            document.getElementById('edit-id').value = index; // Use index as ID for simplicity
            document.getElementById('edit-section').value = section;
            document.getElementById('edit-name').value = item.name;
            document.getElementById('edit-price').value = item.price;
            document.getElementById('edit-image').value = item.image;
            const th = document.getElementById('edit-thumb'); if (th) th.src = item.image || '';
            document.getElementById('edit-category').value = item.category;
            document.getElementById('edit-modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('edit-modal').classList.remove('active');
        }

        function saveChanges() {
            const section = document.getElementById('edit-section').value;
            const index = document.getElementById('edit-id').value;
            const name = document.getElementById('edit-name').value;
            const price = parseFloat(document.getElementById('edit-price').value);
            const image = document.getElementById('edit-image').value;
            const category = document.getElementById('edit-category').value;

            const newItem = {
                id: Date.now(), // Simple ID gen
                name,
                price,
                image,
                category
            };

            if (index === '') {
                // Add new
                currentData[section].push(newItem);
            } else {
                // Update existing
                currentData[section][index] = { ...currentData[section][index], name, price, image, category };
            }

            // Save to LocalStorage
            let key = '';
            if (section === 'restocafe') key = 'restocafe_products';
            if (section === 'fitness') key = 'fitness_products';
            if (section === 'store') key = 'store_products';
            if (section === 'barber') key = 'barber_services';

            localStorage.setItem(key, JSON.stringify(currentData[section]));
            
            renderList(section, currentData[section]);
            closeModal();
        }

        function deleteItem(section, index) {
            if(confirm('Are you sure you want to delete this item?')) {
                currentData[section].splice(index, 1);
                
                let key = '';
                if (section === 'restocafe') key = 'restocafe_products';
                if (section === 'fitness') key = 'fitness_products';
                if (section === 'store') key = 'store_products';
                if (section === 'barber') key = 'barber_services';

                localStorage.setItem(key, JSON.stringify(currentData[section]));
                renderList(section, currentData[section]);
            }
        }

        // Vercel Blob integration
        async function uploadToVercel(file) {
            const base = (location.hostname === 'localhost' || location.hostname === '127.0.0.1') ? 'http://localhost:3001' : '';
            const resp = await fetch(base + '/api/blob-upload', {
                method: 'POST',
                headers: {
                    'x-filename': file.name,
                    'content-type': file.type || 'application/octet-stream'
                },
                body: file
            });
            if (!resp.ok) throw new Error('Upload failed');
            const data = await resp.json();
            return data.url;
        }

        function bindVercelUpload() {
            const btn = document.getElementById('vercel-upload');
            if (!btn) return;
            btn.addEventListener('click', async () => {
                const statusEl = document.getElementById('vercel-status');
                statusEl.textContent = '';
                const file = document.getElementById('vercel-file')?.files?.[0];
                if (!file) { statusEl.textContent = 'اختر صورة'; return; }
                if (file.size > 20 * 1024 * 1024) { statusEl.textContent = 'الملف أكبر من 20MB'; return; }
                statusEl.textContent = 'جاري الرفع...';
                try {
                    const url = await uploadToVercel(file);
                    document.getElementById('edit-image').value = url;
                    const th = document.getElementById('edit-thumb'); if (th) th.src = url;
                    statusEl.textContent = 'تم الرفع';
                } catch (e) {
                    try {
                        const reader = new FileReader();
                        reader.onload = () => {
                            document.getElementById('edit-image').value = reader.result || '';
                            const th = document.getElementById('edit-thumb'); if (th) th.src = reader.result || '';
                            statusEl.textContent = 'استخدام data URL';
                        };
                        reader.onerror = () => { statusEl.textContent = 'فشل الرفع'; };
                        reader.readAsDataURL(file);
                    } catch(_) {
                        statusEl.textContent = 'فشل الرفع';
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', bindVercelUpload);

        // Initial Load (Wait for user interaction to avoid issues?)
        // Better to load only after login
    </script>
</body>
</html>
